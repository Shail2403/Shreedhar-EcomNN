{% extends 'shop/basic.html' %}
{% block title %}Products ‡§∂‡•ç‡§∞‡•Ä‡§ß‡§∞ Entp. {%endblock%}
{% block css %}
        .col-md-3 {
            display: inline-block;
            margin-left: -4px;
        }

        .carousel-indicators .active {
        background-color: blue;
        }

        .col-md-3 img{
          width: 200px;
          height:193px;
        } 
        

        body .carousel-indicators li{
          background-color:blue;
        }

        .carousel-control-prev-icon {
            background: black no-repeat center center;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='%23fff' viewBox='0 0 8 8'%3e%3cpath d='M5.25 0l-4 4 4 4 1.5-1.5-2.5-2.5 2.5-2.5-1.5-1.5z'/%3e%3c/svg%3e");
        } 

        .carousel-control-next-icon {
            background: black no-repeat center center;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='%23fff' viewBox='0 0 8 8'%3e%3cpath d='M2.75 0l-1.5 1.5 2.5 2.5-2.5 2.5 1.5 1.5 4-4-4-4z'/%3e%3c/svg%3e");
        }

        .carousel-control-prev-icon,
        .carousel-control-next-icon{
        background-color: blue;
        } 
        
        .carousel-control-prev,
        .carousel-control-next{
        top:auto;
        bottom:auto;
        padding-top:222px;
        } 

        body.no-padding{
          padding left: 0;
          padding right: 0;
        }

        body .carousel-indicators{
        bottom:0;
        }


        .btn-primary {
          background-color: #007bff;
          color: #fff;
          border: 1px solid #007bff;
        }
    
        .btn-primary:hover {
          background-color: #0056b3;
          border: 1px solid #0056b3;
        }
    
        .minus,
        .plus {
          background-color: #dc3545; /* Lightly dark red color */
          color: #fff;
          border: 1px solid #dc3545;
          margin-right: 5px;
        }
    
        .minus:hover,
        .plus:hover {
          background-color: #c82333; /* Darker red color on hover */
          border: 1px solid #c82333;
        }
    
        /* Additional styles for better alignment */
        .btn-group {
          display: flex;
          align-items: center;
        }
    
        .btn-group button {
          margin: 0;
        }

        #clearCart {
          background-color: teal;
          margin-left: 12px;
        }
      
        #checkout {
          background-color: #ff8c00; 
          margin-right: 12px;
        }

      </style>
        



    {% endblock %} 
{% block body %}
{% load static %}

<div class="container" xmlns:data="http://www.w3.org/1999/xhtml">


<!--        carousel indicators starts from here-->
<!--        slideshow starts here-->

        {% for product,range ,nSlides in allProds%}
        <h5 class="my-3">‚ò£ Festive Discounts on {{product.0.category}} - üõíRecommended  </h5>
        <div class="row">
    <div id="demo{{forloop.counter}}" class="col carousel slide my-3" data-ride="carousel">
        <ul class="carousel-indicators">
            <li data-target="#demo{{forloop.counter}}" data-slide-to="0" class="active"></li>
            {% for i in range %}
            <li data-target="#demo{{forloop..parentloop.counter}}" data-slide-to="{{i}}" ></li>
            {% endfor %}
        </ul>

<!--        slideshow starts here-->

      <div class="carousel-inner">
        <div class="carousel-item active">
            
          <!--  <div class="col-xs-3 col-sm-3 col-md-3">
              <div class="card" style="width: 18rem;">
                <img src='/media/{{product.0.image }}' class="card-img-top text-center" alt="...">
                <div class="card-body">
                  <h6 class="card-title">{{product.0.product_name }}</h6>
                  <p class="card-text">{{product.0.desc }}</p>
                  <button id="pr{{product.0.id}}" class="btn btn-primary cart">Add To Cart</button>
                </div>
              </div>
            </div> -->

            {% for i in product %} <!--|slice:"1:" -->
            <div class="col-xs-3 col-sm-3 col-md-3">
              <div class="card-align-items-center" style="width: 17rem;">
                <img src='/media/{{i.image }}'  class="card-img-top text-center" alt="...">
                
                <div class="card-body">
                  <h6 class="card-title" id="namepr{{i.id}}">{{i.product_name }}</h6>
                  <h6 class="card-title"><em>Price: </em>
                    <span class="card-title" id="pricepr{{i.id}}">{{i.price}}</span><!--<strong><em>‚Çπ}}</em></strong>-->
                  </h6>
                  
                  <p class="card-text">{{i.desc|slice:"0:58"}}...</p>
                  <span id="divpr{{i.id}}" class="divpr">
                  <button  id="pr{{i.id}}"  class="btn btn-primary cart" style="margin-left:-20px;">Add To Cart</button>
                  </span>

                  <a href="/shop/products/{{i.id}}"<button  id="qv{{i.id}}"  class="btn btn-primary cart">View Details</button></a>
                </div>
              </div>
            </div>
            
            
                        {% if forloop.counter|divisibleby:4 and forloop.counter > 0 and not forloop.last %}
                         </div><div class="carousel-item">
                        {% endif %}
                        {% endfor %}
                  </div>
            
                  </div>
                    </div>
            
            <a class="carousel-control-prev " href="#demo{{forloop.counter}}" role="button" data-slide="prev">
               <span class="carousel-control-prev-icon" aria-hidden="true" ></span>
                <span class="sr-only">Previous</span>
              </a>
              <a class="carousel-control-next" href="#demo{{forloop.counter}}" role="button" data-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="sr-only">Next</span>
              </a>
            </div>
              {%endfor%}
            </div>
            <footer style="background-color:#008080; padding: 10px; color: #fff; text-align: center;">
              <p>&copy; 2024 SHREEDHAR ENTERPRISES Pvt Ltd. All rights reserved.</p>
          </footer>
          
            
              {% endblock %}


              {%block js%}
              <script>
                //Find Cart From localStorage
              // console.log("working"); 
                if (localStorage.getItem("cart") == null) {
                  var cart = {};
                } else {
                  //localStorage.setItem('cart', JSON.stringify({}));
                  cart = JSON.parse(localStorage.getItem('cart'));
                    //document.getElementById("cart").innerHTML = Object.keys(cart).length;
                    updateCart(cart);
                 //stringify 2l wwas here
                }
                //$(".cart").click(function () 
                $('.divpr').on('click', 'button.cart', function () {
                 // console.log("cart clicked");
                  var idstr = this.id.toString();
                  //console.log(idstr);
                  if (cart[idstr] != undefined) {
                    //dsp cout 2l 
                    qty = cart[idstr][0] + 1;
                    //name="my item";
                    //cart[idstr] = [qty , name ];   // cart[idstr] + 1
                  } else {
                    qty =  1;
                    name=document.getElementById('name'+idstr).innerHTML;
                    price=document.getElementById('price'+idstr).innerHTML;

                    cart[idstr] = [qty , name,parseInt(price)]; 
                    //1js
                    //cart[idstr] = 1;
                    
                    cart[idstr]
                  }
                  //console.log(cart);
                  updateCart(cart);
                  

                   // Check if the quantity has reached the maximum limit (20)
                  if (cart[idstr] == 20) {
                    setTimeout(function () {
                      showMaxLimitPopover(idstr);
                    }, 2000); // Show the popover after 2 seconds (2000 milliseconds)
                  }
                });

                //popover 
                $("#popcart").popover();
              
                  updatePopover(cart);
                  function updatePopover(cart){
                    //console.log('updatePopover');
                    var popStr = "";
                    popStr =popStr + "<h5>Cart Details </h5><div class='mx-2 my-2'> ";
                    var i=1;
                    for (var item in  cart){
                      if (cart[item][0] > 0) {
                      popStr = popStr + "<b>"+i+"</b>. ";
                      popStr = popStr + document.getElementById('name'+item).innerHTML.slice(0,12)  +"...<b>Units : </b>"+cart[item][0]+'<br>';
                      i=i+1;
                    }
                  }
                    //checkout , clear buttons  
                    //popStr = popStr + ''
                    popStr =popStr + "</div> <a href = '/shop/checkout'><button class='btn btn-primary' id = 'checkout'>Checkout</button></a><button class='btn btn-primary'  onclick='clearCart()' id = 'clearCart'>Clear Cart</button>    "
                    //console.log(popStr);   
                    document.getElementById('popcart').setAttribute('data-content',popStr);
                    $("#popcart").popover('show');                    
                  }

                  function clearCart() {
                    cart = JSON.parse(localStorage.getItem('cart'));
                    //PLUS MINUS BUTTON BACK TO ADD  CART // ID  prN
                    for (var item in cart) {document.getElementById('div'+item).innerHTML = '<button  id="'+ item +'"  class="btn btn-primary cart">Add To Cart</button>'
                  }
                  localStorage.clear();
                  cart={};
                  updateCart();
                }

                  function updateCart(cart){
                    //console.log(cart);
                    //sum show
                    var sum=0;
                    //IF >0 ELSE GO TO ADD
                    for (var item in cart){
                    if (cart[item][0] > 0) {
                      sum= sum + cart[item][0] ;
                      document.getElementById('div' + item).innerHTML = "<button id='minus" + item + "' class='btn btn-primary minus'>-</button> <span id='val" + item + "''>" + cart[item][0] + "</span> <button id='plus" + item + "' class='btn btn-primary plus'> + </button>";
                    }
                    else {
                      document.getElementById('div' + item).innerHTML = '<button id="' + item + '" class="btn btn-primary cart">Add To Cart</button>';
                    }
                  }

                    localStorage.setItem("cart", JSON.stringify(cart));
                    document.getElementById("cart").innerHTML =  sum ;//Object.keys(cart).length; 
                    console.log(cart);
                    updatePopover(cart);
                }

                //IF -+ CART WITH VALUE
                $('.divpr').on("click","button.minus", function(){
                      //console.log("minus clicked");
                      a=this.id.slice(7, );
                      cart['pr'+a][0]=cart['pr'+a][0]-1
                      cart['pr'+a][0]=Math.max(0,cart['pr'+a][0]);
                      document.getElementById('valpr'+a).innerHTML=cart['pr'+a][0];
                      updateCart(cart);
                });

                $('.divpr').on("click","button.plus", function(){
                  //console.log("plus clicked");
                  a=this.id.slice(6, );
                  if (cart['pr' + a][0] < 20) {
                  cart['pr'+a][0]=cart['pr'+a][0]+1
                  document.getElementById('valpr'+a).innerHTML=cart['pr'+a][0];
                  updateCart(cart);
                  }
                  else {
                    // If the user tries to exceed the limit again, show the popover
                    setTimeout(function () {
                      showMaxLimitPopover('pr' + a);
                    }, 1); // Show the popover after 2 seconds (2000 milliseconds)
                  }
            });

             //ADDx
  function showMaxLimitPopover(id) {
    var plusButton = $("#plus" + id);
    var popoverContent = "<div style='color: black; font-weight: bold; font-size: 18px;'>For Larger Quantities,<br> <strong>Contact Us:</strong></div>";
    popoverContent += "<div style='color: blue; text-decoration: underline; font-size: 14px; cursor: pointer;' onclick='makePhoneCall()'>+91 2222222222</div>";

    plusButton.popover({
      content: popoverContent,
      placement: 'top',
      html: true,
    });

    plusButton.popover('show');

    // Set a timeout to hide the popover after x seconds
    setTimeout(function () {
      plusButton.popover('hide');
    }, 2000);

    // Handle clicks anywhere on the document to hide the popover
    $(document).on('click touchstart', function (e) {
      if (!$(e.target).closest('.popover').length) {
        plusButton.popover('hide');
      }
    });
  }

  function makePhoneCall() {
    //   URL based on the requirements of the device
    window.location.href = "tel:+912222222222";
  }

    </script>
    {%endblock%}                  