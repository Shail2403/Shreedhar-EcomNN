{% extends 'shop/basic.html' %} 
{% block title%} Checkout {% endblock%} 
{% block body%}

<div class="container">
  <div class="col my-4">
    <h2>Step 1 ‚éÜ   NNs'üõçÔ∏è  Express Checkout - Review Your Cart Items</h2>
    <div  class='my-3'>
      <ul class="list-group" id="items">
        
      </ul>
    </div>
</div>

    <div class="col my-4">
        <h2>Step 2 ‚éÜ Enter Address & Other Details : </h2>

        <form method="post" action="/shop/checkout/">{% csrf_token%}
            <input type="hidden" name="itemsJson" id="itemsJson">
            <input type="hidden" name="amount" id="amount">
            <div class="form-row">
            <div class="form-group col-md-6">
                <label for="inputname">Name</label>
                <input type="text" class="form-control" id="name"  name="name" placeholder="Name"  required>
            </div>
                <div class="form-group col-md-6">
                    <label for="inputEmail4">Email</label>
                    <input type="email" class="form-control" id="email" name="email" placeholder="Email"  required>
                </div>
            </div>
            <div class="form-group">
                <label for="inputAddress">Address</label>
                <input type="text" class="form-control" id="address1" name="address1" placeholder="1234 Main St"  required>
              </div>
              <div class="form-row">
                <div class="form-group col-md-7">
                  <label for="inputAddress2">Address 2</label>
                  <input type="text" class="form-control" id="address2" name="address2" placeholder="Apartment, studio, or floor">
                </div>
                <div class="form-group col-md-5">
                  <label for="inputPhone">Phone Number</label>
                  <input type="tel" class="form-control" id="phone" name="phone" placeholder="Phone Number"   required>
                </div>
              </div>
            <div class="form-row">
              <div class="form-group col-md-6">
                <label for="inputCity">City</label>
                <input type="text" class="form-control" id="city" name="city" required>
              </div>
              <div class="form-group col-md-4">
                <label for="inputState">State</label>
                <select id="state" name="state" class="form-control"  required>
                  <option selected disabled hidden>Select State...</option> 
                  <option>Gujarat</option>
                  <option>Maharashtra</option>
                  <option>Rajasthan</option>
                </select>
              </div>
              <div class="form-group col-md-2">
                <label for="inputZip">Zip</label>
                <input type="text" class="form-control" id="zip_code" name="zip_code" required>
              </div>
            </div>

            <!--
            <div class="form-check">
                <input class="form-check-input" type="checkbox" id="gridCheck">
                <label class="form-check-label" for="gridCheck">
                    <b>(Select Delivery Paths)</b> Ultra Fast Delivery at additional  Charges
                </label>
                <div id="deliveryDetails" style="display: none; margin-top: 10px;">
                    <p>Get your order delivered within <span id="deliveryTime"><b>X</b> hours</span> for an extra <b>‚Çπ</b><span id="deliveryCharge"><b>‚Çπ</b></span>.</p>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="deliverySpeed" id="oneDay" value="90">
                        <label class="form-check-label" for="oneDay">
                            1 Day (‚Çπ90)
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="deliverySpeed" id="twoDays" value="40">
                        <label class="form-check-label" for="twoDays">
                            2 Days (‚Çπ40)
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="deliverySpeed" id="normalDelivery" value="0" checked>
                        <label class="form-check-label" for="normalDelivery">
                            Normal Delivery (Free)
                        </label>
                    </div>
                </div>
            </div>
        -->

            <div class="form-group">
                <label for="additionalInstructions">Additional Instructions</label>
                <textarea class="form-control" id="add_Ins" name="add_Ins" rows="3" placeholder="Any additional instructions or details about your Order/address"></textarea>
              </div>
            <button type="submit" class="btn btn-primary">Place Order</button>
          </form>

    </div>
</div>

{% endblock%}

{% comment %}
{% block js%}
<script>
    document.getElementById('gridCheck').addEventListener('change', function () {
        var detailsContainer = document.getElementById('deliveryDetails');
        detailsContainer.style.display = this.checked ? 'block' : 'none';
    });

    // Add a script to update delivery details based on radio button selection
    var deliveryTimeSpan = document.getElementById('deliveryTime');
    var deliveryChargeSpan = document.getElementById('deliveryCharge');
    var deliverySpeedRadioButtons = document.getElementsByName('deliverySpeed');

    deliverySpeedRadioButtons.forEach(function (radio) {
        radio.addEventListener('change', function () {
            deliveryTimeSpan.textContent = this.value === '0' ? 'standard time' : this.id === 'oneDay' ? '24 hours' : '2 days';
            deliveryChargeSpan.textContent = this.value;
        });
    });
</script>

{% endblock%}
{% endcomment %}
{% block js%}
<script> 
    if (localStorage.getItem("cart") == null) {
        var cart = {};
      } else {
      //localStorage.setItem('cart', JSON.stringify({}));
        cart = JSON.parse(localStorage.getItem('cart'));
      }
      console.log(cart);

      var sum=0;
      var total_bill = 0;
      if ($.isEmptyObject(cart)) {
        let warningMessage = `<div class="alert alert-warning mt-4" role="alert">
        <h4 class="alert-heading">Your cart is empty!</h4>
        <p class="mb-0">Please add items to your cart before proceeding to checkout.</p>
    </div>`;
    $('#items').append(warningMessage);

    // Add "Go Back" button with Bootstrap styling
    let goBackButton = `<a class="btn btn-primary mt-3" href="/shop/"><i class="fas fa-arrow-left"></i> Go Back</a>`;
    $('#items').append(goBackButton);
      }
      else{
        for( item in cart){
            let name =cart[item][1];
            let qty = cart[item][0];
            let price = cart[item][2] ;
            sum=sum+qty;
            total_bill=total_bill+ price * qty;   
            //let price = {{product.price}};
            //let SubPrice = qty * price;
            mystr= ` <li
            class="list-group-item d-flex justify-content-between align-items-center" >
            ${name}
            <span class="badge badge-primary badge-pill">${qty} Items / Rs.${price}</span>
            </li>`
            //            <span class="ml-4">SubPrice: ${qty}</span>
            

            $('#items').append(mystr);
        }
        
        total = `<div class="alert alert-success" role="alert"><li class="list-group-item d-flex justify-content-between align-items-center">
        <h3>Total Bill</h3>
        <h3>  Rs. <span id="total_bill">${total_bill}</span>  </h3>
       </li></div>`
          $('#items').append(total);
      }
      document.getElementById("cart").innerHTML =  sum ;
      document.getElementById("total_bill").innerHTML =  total_bill ;

      $('#itemsJson').val(JSON.stringify(cart) );
      {% if thank %}
      alert('Thanks for ordering with Us. Your Order  ID  is  {{id}}, Use it to Track your Order Using Order-Tracker.!')
      localStorage.clear();
      document.location="/shop/"
      {% endif %}
      $('#amount').val($('#total_bill').html())
</script>
{% endblock%}